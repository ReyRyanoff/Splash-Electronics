<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart</title>
    <!-- tailwind -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- DaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <!-- font awesome -->
    <script src="https://kit.fontawesome.com/0bf214db9f.js" crossorigin="anonymous"></script>
    <!-- flowbite -->
    <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
</head>

<body class="bg-gradient-to-b from-green-100 via-gray-100 to-blue-100  text-gray-800">
    <header class="bg-blue-50 shadow">
        <nav class="h-20 mx-auto pt-2 flex justify-center items-center">
            <ul class="flex justify-center space-x-50">
                <li><a href="index.html"><img src="images/home.png" alt="Home" title="Home" class="w-6 h-6"></a></li>
                <li><a href="cart.html"><img src="images/shopping cart.png" alt="Cart" title="Cart" class="w-6 h-6"></a>
                </li>
            </ul>
        </nav>
    </header>

    <main class="container mx-auto p-6">
        <h1 class="text-2xl font-bold mb-6 pl-30">Your Shopping Cart</h1>
        <section class="cart-items space-y-4">

            <a href="index.html" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600 relative" style="left: 120px;">
                Back to Home
            </a>
            <div id="cart-items" class="pt-5 ml-15"></div>

            <div id="cart-summary" class="mt-4 pl-30 pt-5">
                <p class="text-lg font-semibold">Total Products: <span id="total-products">0</span></p>
                <p id="total-price-wrapper"  class="text-lg font-semibold">Total Price: <span id="total-price">$0.00</span></p>
            </div>

            <!-- Place Order button -->
            <button id="place-order-btn" class="mt-6 bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600 relative" style="left: 120px;">
                Place Order
            </button>

            <!-- Order success message -->
            <div id="order-success" class="mt-6 p-4 bg-green-100 text-green-800 rounded hidden text-center">
                ðŸŽ‰ Your order has been placed successfully! Thank you for shopping with us!
            </div>


            <div id="empty-cart" class="text-center py-10 hidden">
                <p class="text-2xl font-semibold mb-4">Your cart is empty.</p>

            </div>


            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const cartContainer = document.getElementById("cart-items");
                    const summaryCount = document.getElementById("total-products");
                    const summaryPrice = document.getElementById("total-price");
                    const emptyCartMessage = document.getElementById("empty-cart");

                    let cart = JSON.parse(localStorage.getItem("cart")) || [];

                    function renderCart() {
                        cartContainer.innerHTML = "";

                        if (cart.length === 0) {
                            emptyCartMessage.classList.remove("hidden");
                            summaryCount.textContent = "0";
                            summaryPrice.textContent = "$0.00";

                            // Remove shipping charge if exists
                            const shippingElement = document.getElementById("shipping-charge");
                            if (shippingElement) {
                                shippingElement.remove();
                            }

                            // Remove delivery charge if exists
                            const deliveryElement = document.getElementById("delivery-charge");
                            if (deliveryElement) {
                                deliveryElement.remove();
                            }

                            // Remove the Place Order button if it exists
                            const placeOrderButton = document.getElementById("place-order-btn");
                            if (placeOrderButton) {
                                placeOrderButton.remove();
                            }

                            return;
                        }

                        emptyCartMessage.classList.add("hidden");

                        let total = 0;

                        cart.forEach((product, index) => {
                            total += product.price;

                            const item = document.createElement("div");
                            item.className = "flex items-center justify-between bg-white p-4 mb-2 rounded shadow";
                            item.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <img src="${product.image}" alt="${product.name}" class="w-16 h-16 object-cover rounded">
                        <div>
                            <p class="font-semibold">${product.name}</p>
                            <p class="text-gray-600">$${product.price.toFixed(2)}</p>
                        </div>
                    </div>
                    <button class="text-red-500 hover:text-red-700" data-index="${index}">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                `;
                            cartContainer.appendChild(item);
                        });

                        // Add shipping charge
                        const shippingCharge = 10; // Fixed shipping charge
                        let shippingChargeElement = document.getElementById("shipping-charge");
                        if (!shippingChargeElement) {
                            shippingChargeElement = document.createElement("p");
                            shippingChargeElement.id = "shipping-charge";
                            shippingChargeElement.className = "text-lg font-semibold";
                            document.getElementById("cart-summary").insertBefore(shippingChargeElement, document.getElementById("delivery-charge"));
                        }

                        // updating the shipping text
                        shippingChargeElement.textContent = `Shipping Charge: $${shippingCharge.toFixed(2)}`;
                        total += shippingCharge;


                        // Calculate delivery charge
                        let deliveryCharge = 0;
                        const chargePer500 = 20; // $20 for every $500
                        if (total >= 200) {
                            deliveryCharge = Math.ceil(total / 500) * chargePer500;
                            total += deliveryCharge; // Add delivery charge to total
                        }

                        // cart summary with total products price & delivery charge
                        const deliveryChargeElement = document.getElementById("delivery-charge");
                        if (!deliveryChargeElement) {
                            const deliveryChargeDiv = document.createElement("p");
                            deliveryChargeDiv.id = "delivery-charge";
                            deliveryChargeDiv.className = "text-lg font-semibold";
                            deliveryChargeDiv.textContent = `Delivery Charge: $${deliveryCharge.toFixed(2)}`;
                            document.getElementById("cart-summary").appendChild(deliveryChargeDiv);
                        } else {
                            deliveryChargeElement.textContent = `Delivery Charge: $${deliveryCharge.toFixed(2)}`;
                        }
                        
                        // Update total price with delivery charge
                        summaryCount.textContent = cart.length;
                        summaryPrice.textContent = `$${total.toFixed(2)}`;

                        // Move total-price-wrapper to bottom of summary (below delivery)
                        const cartSummary = document.getElementById("cart-summary");
                        const totalPriceWrapper = document.getElementById("total-price-wrapper");
                        if (totalPriceWrapper) {
                            cartSummary.appendChild(totalPriceWrapper); // Moves it to the end
                        }

                        // Add remove event listeners
                        document.querySelectorAll('button[data-index]').forEach(btn => {
                            btn.addEventListener("click", function () {
                                const idx = parseInt(this.getAttribute("data-index"));
                                cart.splice(idx, 1);
                                localStorage.setItem("cart", JSON.stringify(cart));
                                renderCart();
                            });
                        });
                    }

                    renderCart();

                    // âœ… Place Order logic
                    document.getElementById("place-order-btn").addEventListener("click", function () {
                        if (cart.length === 0) {
                            alert("Your cart is already empty!");
                            return;
                        }

                        // Clear cart and localStorage
                        cart = [];
                        localStorage.setItem("cart", JSON.stringify(cart));

                        // Show success message
                        document.getElementById("order-success").classList.remove("hidden");

                        // Rerender cart to reflect empty state
                        renderCart();

                        // Optional: hide the message after 4 seconds
                        setTimeout(() => {
                            document.getElementById("order-success").classList.add("hidden");
                        }, 4000);
                    });
                });
            </script>
            <div id="cart-items" class="space-y-4"></div>

        </section>


    </main>

    <footer class="bg-green-200 text-gray-600 shadow-inner mt-8 pb-0">
        <p class="text-center text-gray-600 py-4">&copy; 2023 Splash Electronics. All rights reserved.</p>
    </footer>
</body>

</html>